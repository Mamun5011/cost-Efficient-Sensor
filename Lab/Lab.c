#include <avr/io.h>
#define F_CPU 1000000
#include <util/delay.h>

void testMatrix();
void ShapeMatrix(int);
char PORTS[8] = {1,2,4,8,16,32,64,128};//pin values of PORTD
static int curr[]={0b11111111,0b11111111,0b11111111,0b11111111,0b11111111,0b11111111,0b11111111,0b11111111};	
static int ALPHA[16][8]={{0b01111111,0b11111111,0b11111111,0b11111111,0b11111111,0b11111111,0b11111111,0b11111111},
{0b11111111,0b11111111,0b01111111,0b11111111,0b11111111,0b11111111,0b11111111,0b11111111},
{0b11111111,0b11111111,0b11111111,0b11111111,0b01111111,0b11111111,0b11111111,0b11111111},
{0b11111111,0b11111111,0b11111111,0b11111111,0b11111111,0b11111111,0b01111111,0b11111111},
{0b11011111,0b11111111,0b11111111,0b11111111,0b11111111,0b11111111,0b11111111,0b11111111},
{0b11111111,0b11111111,0b11011111,0b11111111,0b11111111,0b11111111,0b11111111,0b11111111},
{0b11111111,0b11111111,0b11111111,0b11111111,0b11011111,0b11111111,0b11111111,0b11111111},
{0b11111111,0b11111111,0b11111111,0b11111111,0b11111111,0b11111111,0b11011111,0b11111111},
{0b11110111,0b11111111,0b11111111,0b11111111,0b11111111,0b11111111,0b11111111,0b11111111},
{0b11111111,0b11111111,0b11110111,0b11111111,0b11111111,0b11111111,0b11111111,0b11111111},
{0b11111111,0b11111111,0b11111111,0b11111111,0b11110111,0b11111111,0b11111111,0b11111111},
{0b11111111,0b11111111,0b11111111,0b11111111,0b11111111,0b11111111,0b11110111,0b11111111},
{0b11111101,0b11111111,0b11111111,0b11111111,0b11111111,0b11111111,0b11111111,0b11111111},
{0b11111111,0b11111111,0b11111101,0b11111111,0b11111111,0b11111111,0b11111111,0b11111111},
{0b11111111,0b11111111,0b11111111,0b11111111,0b11111101,0b11111111,0b11111111,0b11111111},
{0b11111111,0b11111111,0b11111111,0b11111111,0b11111111,0b11111111,0b11111101,0b11111111}};
	
void CurrMatrix()
{
	for (int j=0;j<8;j++)
	{
		for (int n=0;n<50;n++)
		{ //to catch eye
			PORTA = PORTS[j];// ROW
			unsigned int tempAlpha = curr[j];
			
			PORTD = tempAlpha;//show character (COLUMN)
		}
		//_delay_ms(100);
		//PORTA=0x00;//clear screen after show
		
	}
	
}

void ClearMatrix()
{
int i;
for(i=0;i<8;i++)curr[i] |=0xFF;	
		
}
	
int main(void)
{
	DDRD = 0xFF;//PORTB,C,D are set as output
	DDRA = 0xFF;
	DDRC = 0x00;
	DDRB = 0x0F;
	
	
	while(1)
	{
		//testMatrix();			
       int previousK=-1,i,j;
	   for(i=0;i<16;i++)
	   {
		   if((PINC & 0b10000000)){
			   ClearMatrix();
		   }
		  PORTB=i  ;
		  _delay_us(1);
		  if((PINC & 0b00000001)){
			  //previousK=i;
			for (j = 0; j < 8; j++)
			{
				curr[j] &= ALPHA[i][j];
			}  
			
		  }
		  //if(previousK!=-1){
			  //ShapeMatrix(previousK);
		  //}
		  //previousK=-1;
	   }
		CurrMatrix();
	   //_delay_ms(100);
	   
	}
}

